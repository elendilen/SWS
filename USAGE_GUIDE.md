# 小车控制系统使用说明

## 快速启动

### 1. 启动优化版本（推荐）
```bash
cd /home/lenovo/SWS
./start_car_optimized.sh
```

### 2. 启动原版本
```bash
cd /home/lenovo/SWS
./start_car_web.sh
```

## 控制方式

### 网页控制
- 在浏览器中打开 `http://localhost:5800`
- 使用按钮控制小车移动
- 实时查看摄像头画面

### 键盘控制（已修复）
- **W/↑**: 前进
- **S/↓**: 后退  
- **A/←**: 左转
- **D/→**: 右转
- **空格**: 拍照
- **Q/ESC**: 停止

### 紧急停止
- **红色急停按钮**: 立即停止
- **切换窗口**: 自动停止
- **关闭浏览器**: 自动停止

## 测试功能

### 键盘控制测试
访问 `http://localhost:5800/keyboard_test` 进行键盘控制测试

### 性能测试
```bash
cd /home/lenovo/SWS
python3 test_performance.py
```

### 键盘响应测试
```bash
cd /home/lenovo/SWS
python3 test_keyboard.py
```

## 功能说明

### 视频流
- 实时显示摄像头画面
- 自动调整分辨率和帧率
- 支持拍照和相册管理

### 控制命令
- 响应时间优化至100ms以内
- 支持连续控制和精确停止
- 多重安全停止机制

### 状态监控
- 实时显示连接状态
- 显示当前执行命令
- 串口连接状态监控

## 问题解决

### WASD键盘控制不工作
1. 确保页面已完全加载
2. 点击页面确保获得焦点
3. 检查浏览器是否支持键盘事件
4. 访问测试页面进行诊断

### 串口连接问题
- 检查串口设备是否连接
- 使用重连按钮尝试重新连接
- 确认串口权限设置正确

### 摄像头问题
- 检查摄像头是否正常工作
- 重启系统重新初始化摄像头
- 检查摄像头占用情况

### 网络访问问题
- 确认防火墙设置允许5800端口
- 检查IP地址和端口配置
- 尝试使用IP地址而非localhost

## 最新修复

### 键盘控制修复（v2.2）
- ✓ 修复了WASD键盘控制失效的问题
- ✓ 重新添加了键盘事件监听器
- ✓ 优化了按键响应逻辑
- ✓ 添加了键盘控制测试页面
- ✓ 增加了页面加载提示
- ✓ 改进了按键释放停止机制

### 使用提示
- 页面加载完成后会显示"键盘控制已激活"提示
- 确保点击页面获得焦点后再使用键盘控制
- 如果键盘控制仍有问题，访问 `/keyboard_test` 页面进行诊断

## 安全提醒

- 使用前确保操作环境安全
- 随时准备使用紧急停止功能
- 定期检查硬件连接状态
- 避免在网络不稳定时操作
